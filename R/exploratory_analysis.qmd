---
title: "exploratory_analysis"
format: html
---

# Setting up data

```{r}
library(DEXSeq)
library(fgsea)
library(msigdbr)
library(stringr)

load(file='/home/projects/22140/exam_data/exam_functions.Rdata')

isoform_count_08 <-loadIsoformCountMatrix('GSE106608')
isoform_count_77 <-loadIsoformCountMatrix('GSE128177')

gene_count_08 <- extractGeneCountMatrixFromIsoCounts(isoform_count_08)
gene_count_77 <- extractGeneCountMatrixFromIsoCounts(isoform_count_77)

isoform_count_08 <- as.data.frame(isoform_count_08)
isoform_count_77 <- as.data.frame(isoform_count_77)

isoInfo <- read_rds(
paste0(
'/home/projects/22140/exam_data/',
'Homo_sapiens.GRCh38.107.chr_patch_hapl_scaff_tx_info.Rds'
)
)
```

### Meta data

```{r}
file_path_08 <- "../metadata_temporary/Template_group6_GSE106608.csv"

metadata_df_08 <- read.csv(
  file_path_08,
  skip = 6,
  stringsAsFactors = FALSE
)
colnames(metadata_df_08)[5] <- "groups"

head(metadata_df_08)

```

```{r}
file_path_77 <- "../metadata_temporary/Template_group6_GSE128177.csv"

metadata_df_77 <- read.table(
  file_path_77,
  sep = ";",
  header = TRUE,
  skip = 6,
  stringsAsFactors = FALSE,
  quote = "\""   # Handle quoted fields
)

colnames(metadata_df_77)[5] <- "groups"

# Remove quotes from groups column
metadata_df_77$groups <- gsub("\"", "", metadata_df_77$groups)

metadata_df_77
```

### Splitting characteristics into gender and age

#### 08 datafile

```{r}
metadata_df_08 <- metadata_df_08 |>
  mutate(gender = str_extract(characteristics, "(?<=Sex: )\\w$")
  )

metadata_df_08 <- metadata_df_08 |>
  mutate(
    age = as.integer(str_extract(characteristics, "(?<=age: )\\d+"))
  )

head(metadata_df_08)
```

#### 77 datafile

```{r}
metadata_df_77 <- metadata_df_77 |>
  mutate(
    gender = str_extract(characteristics, "(?<=gender: )[^,]+")
  )

metadata_df_77 <- metadata_df_77 |>
  mutate(
    age = as.integer(str_extract(characteristics, "(?<=age: )\\d+"))
  )

head(metadata_df_77)
```

# Load Result files

```{r}
res_gender_08 <- readRDS('../data/deseq2_results_08.rds')
#res_gender_08 <- readRDS('../data/deseq2_object_08.rds')
res_gender_77 <- readRDS('../data/deseq2_results_77.rds')
#res_gender_77 <- readRDS('../data/deseq2_object_77.rds')
dxdResult_08 <- readRDS('../data/dexseq_results_08.rds')
dxdResult_77 <- readRDS('../data/dexseq_results_77.rds')
```

```{r}
df_deseq_08 <- as.data.frame(res_gender_08)
df_deseq_77 <- as.data.frame(res_gender_77)
df_dexseq_08 <- as.data.frame(dxdResult_08)
df_dexseq_77 <- as.data.frame(dxdResult_77)
```

```{r}
res_gender_age_08 <- readRDS('../data/deseq2_object_08_age.rds')
res_gender_age_77 <- readRDS('../data/deseq2_results_77_age.rds')
df_deseq_08_age <- as.data.frame(res_gender_08)
df_deseq_77_age <- as.data.frame(res_gender_77)
```

# Questions

-   Numberof genes in isoforms == number of genes in genecount

-   Combine all 4 dataset, combine them all at once or pariwise and then 08 and 77 together

-   significance of contrast in DeSeq2 results?

-   negative ES means downregulation\[Gemini: Yes, in average the genes are downregulated\]? Why is the directional and non-directional FGSEA so different?

-   What is leading Edge in the FGSEA analysis?

-   Why do we have so few significant isoform and genes in the 77 datatset

-   Why do we use fishers test to integrate two transcriptional dataset? Why not edingtons? Is DeSeq and DEXSeq not from the same level

-   Why using unadjusted pvalue for integration?

-   Why do we suddenly have more significant genes in DEXSeq for 77 after the p-value integration

-   How long is the presentation supposed to be?

# TODOs

-   Find out the meaning of contrast in the Result pulliing of DeSeq2(Interpretation of Age as cofounder)

-   Basic research on Parkinson(Sander)

-   Maltes results for dexseq dataset 77

-   77: remove young healthy adults, rerun DEXSeq(if more significant also need to rerun all other analysis)(Cecilie)

-   Figure folder, save plots(PCA)(Amanda)

-   Start Presentation(Cecilie)

    -   introduction(Background-Sander, Data-Cora)

-   

```{r}
isoform_count_08 %>% group_by()

isoInfo
```
